---
title: "PNAD Contínua" # Título do relatório
subtitle: "**Primário e Secundário: Ano/Trimestre - RS/BR**"
author: "Fernanda Kelly R. Silva | www.fernandakellyrs.com"
lang: pt 
date: "`r format(Sys.Date())`" 
date-format: short 
toc: true 
format: 
    html: 
      embed-resources: true
      #css: ["custom.css"] 
      code-fold: false 
      code-tools: true  
      theme: 
        light: cosmo
        dark: superhero 
#title-block-banner: "#874a9c" 
code-annotations: hover 
execute:
  warning: false
  message: false
  echo: false
---

```{r}
options(timeout = 600) 
```

```{r}
#| echo: false
#| 
# install.packages("PNADcIBGE")
# install.packages("survey")
library(PNADcIBGE)
library(survey)
library(foreign)
library(srvyr)
library(reactable)
library(purrr)
```

# Dados

## Trimestre

### Rio Grande do Sul (RS)

```{r}
anos <- 2012:2025
tabPSTRI_NPRINCIPAL <- map_dfr(
  anos,
  ~ read_excel(
    path  = glue::glue("Dados/tabPSTRI_RS_4.xlsx"),
    sheet = "N PRINCIPAL"
  ) 
)

tabPSTRI_HABITUALPRINCIPAL <- map_dfr(
  anos,
  ~ read_excel(
    path  = glue::glue("Dados/tabPSTRI_RS_4.xlsx"),
    sheet = "HABITUAL PRINCIPAL"
  ) 
)

tabPSTRI_EFETIVAPRINCIPAL <- map_dfr(
  anos,
  ~ read_excel(
    path  = glue::glue("Dados/tabPSTRI_RS_4.xlsx"),
    sheet = "EFETIVA PRINCIPAL"
  ) 
)

tabPSTRI_NSECUNDARIO <- map_dfr(
  anos,
  ~ read_excel(
    path  = glue::glue("Dados/tabPSTRI_RS_4.xlsx"),
    sheet = "N SECUNDÁRIO"
  )
)

tabPSTRI_HABITUALSECUNDARIO <- map_dfr(
  anos,
  ~ read_excel(
    path  = glue::glue("Dados/tabPSTRI_RS_4.xlsx"),
    sheet = "HABITUAL SECUNDÁRIO"
  ) 
)

tabPSTRI_EFETIVASECUNDARIO <- map_dfr(
  anos,
  ~ read_excel(
    path  = glue::glue("Dados/tabPSTRI_RS_4.xlsx"),
    sheet = "EFETIVA SECUNDÁRIO"
  ) 
)


```



```{r}

###########################################################
# TESTE DE CÁLCULO DAS HORAS HABITUAIS UTILIZANDO O DUCKDB
###########################################################

library(DBI)
library(duckdb)
library(dplyr)

con <- dbConnect(
  duckdb(),
  dbdir = "dados/pnad.duckdb"
)

env_tmp <- new.env()

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Trimestre/dadosPNADc2023_completo.RData", envir = env_tmp)

pnad2023 <- env_tmp$dadosPNADc2023_completo

#criar a tabela no duckdb
dbWriteTable(con, "dadosPNADc2023_completo",
             pnad2023, overwrite = TRUE)

dadosPNADC_2023 <- tbl(con, "dadosPNADc2023_completo") 








##########################################
# DESCONECTAR O DBI
##########################################

dbDisconnect(con, shutdown = TRUE)

```



















