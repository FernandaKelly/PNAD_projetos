---
title: "PNAD Contínua" # Título do relatório
subtitle: "**Demandas Rápidas**"
author: "Fernanda Kelly R. Silva | www.fernandakellyrs.com"
lang: pt 
date: "`r format(Sys.Date())`" 
date-format: short 
toc: true 
format: 
    html: 
      embed-resources: true
      #css: ["custom.css"] 
      code-fold: false 
      code-tools: true  
      theme: 
        light: cosmo
        dark: superhero 
#title-block-banner: "#874a9c" 
code-annotations: hover 
execute:
  warning: false
  message: false
  echo: false
---

```{r}
options(timeout = 600) 
options(scipen = 999)
```

```{r}
#| echo: false
#| 
# install.packages("PNADcIBGE")
# install.packages("survey")
library(PNADcIBGE)
library(survey)
library(foreign)
library(srvyr)
library(reactable)
library(purrr)
```

```{r}
load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Trimestre/dadosPNADc2023_completo.RData")
```

```{r}
dadosPNADc2023_RS <- dadosPNADc2023_completo %>% 
  dplyr::filter(UF == "Rio Grande do Sul" & VD4002 == "Pessoas ocupadas") 
  #dplyr::filter(UF == "Rio Grande do Sul" & Trimestre == 1) 

```

# Principal

```{r}

dadosPNADc2023_RS  <- PNADcIBGE::pnadc_design(dadosPNADc2023_RS)
dadosPNADc2023_RS_PSV <- srvyr::as_survey(dadosPNADc2023_RS)

table_P <- dadosPNADc2023_RS_PSV %>% 
  dplyr::mutate(VD4002 = base::as.numeric(VD4002)) %>% 
  dplyr::group_by(V4013) %>% 
  dplyr::summarise(N_P = srvyr::survey_total(VD4002 == 1, na.rm = TRUE))

```

```{r}
table_P <- survey::svyby(~VD4002 == "Pessoas ocupadas", ~V4013,
               design = dadosPNADc2023_RS_P,
               svytotal,
               na.rm = TRUE,
               vartype=c("se","cv","cvpct","var"))
```

## Demanda: Principal & Renda (2019-2024)

```{r}

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc1VISITA_2019.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc5VISITA_2020.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc5VISITA_2021.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc5VISITA_2022.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc1VISITA_2023.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc1VISITA_2024.RData")

```

```{r}

dadosPNADc1VISITA_2019  <- PNADcIBGE::pnadc_design(dadosPNADc1VISITA_2019)
dadosPNADc1VISITA_2019 <- srvyr::as_survey(dadosPNADc1VISITA_2019)

dadosPNADc1VISITA_2019 <- dadosPNADc1VISITA_2019 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") %>% 
  dplyr::filter(VD4002 == "Pessoas ocupadas") 

table_1P_2019 <- dadosPNADc1VISITA_2019 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")),
                   Qtd_horasHabituais = srvyr::survey_total(V4039,
                                                   na.rm = TRUE),
                   
                   Qtd_renda = srvyr::survey_total(VD4017,
                                                   na.rm = TRUE)
  )



```

```{r}
dadosPNADc5VISITA_2020  <- PNADcIBGE::pnadc_design(dadosPNADc5VISITA_2020)
dadosPNADc5VISITA_2020 <- srvyr::as_survey(dadosPNADc5VISITA_2020)

dadosPNADc5VISITA_2020 <- dadosPNADc5VISITA_2020 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") %>% 
  dplyr::filter(VD4002 == "Pessoas ocupadas") 

table_1P_2020 <- dadosPNADc5VISITA_2020 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")),
                   Qtd_horasHabituais = srvyr::survey_total(V4039,
                                                   na.rm = TRUE),
                   
                   Qtd_renda = srvyr::survey_total(VD4017,
                                                   na.rm = TRUE)
  )


```

```{r}
dadosPNADc5VISITA_2021  <- PNADcIBGE::pnadc_design(dadosPNADc5VISITA_2021)
dadosPNADc5VISITA_2021 <- srvyr::as_survey(dadosPNADc5VISITA_2021)

dadosPNADc5VISITA_2021 <- dadosPNADc5VISITA_2021 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") %>% 
  dplyr::filter(VD4002 == "Pessoas ocupadas") 

table_1P_2021 <- dadosPNADc5VISITA_2021 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")),
                   Qtd_horasHabituais = srvyr::survey_total(V4039,
                                                   na.rm = TRUE),
                   
                   Qtd_renda = srvyr::survey_total(VD4017,
                                                   na.rm = TRUE)
  )

```


```{r}
dadosPNADc5VISITA_2022  <- PNADcIBGE::pnadc_design(dadosPNADc5VISITA_2022)
dadosPNADc5VISITA_2022 <- srvyr::as_survey(dadosPNADc5VISITA_2022)

dadosPNADc5VISITA_2022 <- dadosPNADc5VISITA_2022 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") %>% 
  dplyr::filter(VD4002 == "Pessoas ocupadas")

table_1P_2022 <- dadosPNADc5VISITA_2022 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")),
                   Qtd_horasHabituais = srvyr::survey_total(V4039,
                                                   na.rm = TRUE),
                   
                   Qtd_renda = srvyr::survey_total(VD4017,
                                                   na.rm = TRUE)
  )
```

```{r}
dadosPNADc1VISITA_2023  <- PNADcIBGE::pnadc_design(dadosPNADc1VISITA_2023)
dadosPNADc1VISITA_2023 <- srvyr::as_survey(dadosPNADc1VISITA_2023)

dadosPNADc1VISITA_2023 <- dadosPNADc1VISITA_2023 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") %>% 
  dplyr::filter(VD4002 == "Pessoas ocupadas")

table_1P_2023 <- dadosPNADc1VISITA_2023 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")),
                   Qtd_horasHabituais = srvyr::survey_total(V4039,
                                                   na.rm = TRUE),
                   
                   Qtd_renda = srvyr::survey_total(VD4017,
                                                   na.rm = TRUE)
  )
```


```{r}
dadosPNADc1VISITA_2024  <- PNADcIBGE::pnadc_design(dadosPNADc1VISITA_2024)
dadosPNADc1VISITA_2024 <- srvyr::as_survey(dadosPNADc1VISITA_2024)

dadosPNADc1VISITA_2024 <- dadosPNADc1VISITA_2024 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") %>% 
  dplyr::filter(VD4002 == "Pessoas ocupadas")

table_1P_2024 <- dadosPNADc1VISITA_2024 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")),
                   Qtd_horasHabituais = srvyr::survey_total(V4039,
                                                   na.rm = TRUE),
                   
                   Qtd_renda = srvyr::survey_total(VD4017,
                                                   na.rm = TRUE)
  )
```


```{r}

table_1P <- table_1P_2019 %>% 
  dplyr::bind_rows(table_1P_2020, table_1P_2021, table_1P_2022, table_1P_2023, table_1P_2024) %>% 
  dplyr::filter(!(is.na(V4013))) %>% 
  dplyr::select(V4013, Ano, freq, Qtd_horasHabituais, Qtd_renda)

```




# Secundário 

```{r}

dadosPNADc2023_RS  <- PNADcIBGE::pnadc_design(dadosPNADc2023_RS)
dadosPNADc2023_RS_PSV <- srvyr::as_survey(dadosPNADc2023_RS)

table_S <- dadosPNADc2023_RS_PSV %>%                                           
  dplyr::mutate(VD4002 = base::as.numeric(VD4002)) %>%                                              
  dplyr::group_by(V4044) %>% 
  dplyr::summarise(N_S = srvyr::survey_total(VD4002 == 1, na.rm = TRUE))

```


```{r}
table_S <- survey::svyby(~VD4002 == "Pessoas ocupadas", ~V4044,
               design = dadosPNADc2023_RS_P,
               svytotal,
               na.rm = TRUE,
               vartype=c("se","cv","cvpct","var"))
```

# Principal & Secundário (2019-2024)

```{r}

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc1VISITA_2019.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc5VISITA_2020.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc5VISITA_2021.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc5VISITA_2022.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc1VISITA_2023.RData")

load("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/Dados_completos/Visitas/dadosPNADc1VISITA_2024.RData")

```

## Demanda: Anos (2019-2024)

```{r}

dadosPNADc1VISITA_2019  <- PNADcIBGE::pnadc_design(dadosPNADc1VISITA_2019)
dadosPNADc1VISITA_2019 <- srvyr::as_survey(dadosPNADc1VISITA_2019)

dadosPNADc1VISITA_2019 <- dadosPNADc1VISITA_2019 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") 

table_1P_2019 <- dadosPNADc1VISITA_2019 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))

table_1S_2019 <- dadosPNADc1VISITA_2019 %>%  
  dplyr::group_by(V4044, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))
```

```{r}
dadosPNADc5VISITA_2020  <- PNADcIBGE::pnadc_design(dadosPNADc5VISITA_2020)
dadosPNADc5VISITA_2020 <- srvyr::as_survey(dadosPNADc5VISITA_2020)

dadosPNADc5VISITA_2020 <- dadosPNADc5VISITA_2020 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") 

table_1P_2020 <- dadosPNADc5VISITA_2020 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))

table_1S_2020 <- dadosPNADc5VISITA_2020 %>%  
  dplyr::group_by(V4044, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))
```

```{r}
dadosPNADc5VISITA_2021  <- PNADcIBGE::pnadc_design(dadosPNADc5VISITA_2021)
dadosPNADc5VISITA_2021 <- srvyr::as_survey(dadosPNADc5VISITA_2021)

dadosPNADc5VISITA_2021 <- dadosPNADc5VISITA_2021 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") 

table_1P_2021 <- dadosPNADc5VISITA_2021 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))

table_1S_2021 <- dadosPNADc5VISITA_2021 %>%  
  dplyr::group_by(V4044, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))
```


```{r}
dadosPNADc5VISITA_2022  <- PNADcIBGE::pnadc_design(dadosPNADc5VISITA_2022)
dadosPNADc5VISITA_2022 <- srvyr::as_survey(dadosPNADc5VISITA_2022)

dadosPNADc5VISITA_2022 <- dadosPNADc5VISITA_2022 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") 

table_1P_2022 <- dadosPNADc5VISITA_2022 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))

table_1S_2022 <- dadosPNADc5VISITA_2022 %>%  
  dplyr::group_by(V4044, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))
```

```{r}
dadosPNADc1VISITA_2023  <- PNADcIBGE::pnadc_design(dadosPNADc1VISITA_2023)
dadosPNADc1VISITA_2023 <- srvyr::as_survey(dadosPNADc1VISITA_2023)

dadosPNADc1VISITA_2023 <- dadosPNADc1VISITA_2023 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") 

table_1P_2023 <- dadosPNADc1VISITA_2023 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))

table_1S_2023 <- dadosPNADc1VISITA_2023 %>%  
  dplyr::group_by(V4044, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))
```


```{r}
dadosPNADc1VISITA_2024  <- PNADcIBGE::pnadc_design(dadosPNADc1VISITA_2024)
dadosPNADc1VISITA_2024 <- srvyr::as_survey(dadosPNADc1VISITA_2024)

dadosPNADc1VISITA_2024 <- dadosPNADc1VISITA_2024 %>% 
    dplyr::filter(UF == "Rio Grande do Sul") 

table_1P_2024 <- dadosPNADc1VISITA_2024 %>%  
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))

table_1S_2024 <- dadosPNADc1VISITA_2024 %>%  
  dplyr::group_by(V4044, Ano) %>% 
  dplyr::summarise(freq = srvyr::survey_total(vartype = c("se", "ci", "var", "cv")))
```


```{r}
table_1P <- table_1P_2019 %>% 
  dplyr::bind_rows(table_1P_2020, table_1P_2021, table_1P_2022, table_1P_2023, table_1P_2024) %>% 
  dplyr::filter(!(is.na(V4013))) %>% 
  dplyr::select(V4013, freq, Ano)

table_1S <- table_1S_2019 %>% 
  dplyr::bind_rows(table_1S_2020, table_1S_2021, table_1S_2022, table_1S_2023, table_1S_2024) %>% 
  dplyr::filter(!(is.na(V4044))) %>% 
  dplyr::select(V4044, freq, Ano)

table_PS_19_24 <- table_1P %>% 
  dplyr::left_join(table_1S, by = c("V4013" = "V4044", "Ano" = "Ano")) %>% 
  dplyr::group_by(V4013, Ano) %>% 
  dplyr::summarise(somaN = base::sum(freq.x, freq.y, na.rm = TRUE))

```




# Excel

```{r}
sheets <- list("PRINCIPAL"    = table_P,
               "SECUNDARIO"   = table_S)

writexl::write_xlsx(sheets, 
           paste0("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/PNAD_projetos/Dados/tabPS2023_1.xlsx"))

#######################################
writexl::write_xlsx(table_PS_19_24, 
           paste0("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/PNAD_projetos/Dados/table_PS_19_24_2.xlsx"))


#######################################
writexl::write_xlsx(table_1P, 
           paste0("C:/Users/fernanda-romeiro/OneDrive - Governo do Estado do Rio Grande do Sul/Projetos/PNAD/PNAD_projetos/Dados/tableRenda_P_19_24_1.xlsx"))
```



























